{
    "indicator_1_1": {
        "number": "1",
        "setting": "2-2",
        "value": "> -100"
    },
    "indicator_1_2": {
        "number": "2",
        "setting": "2-2",
        "value": "< -100"
    },
    "position_action_1": {
        "direction": "long",
        "order": "close",
        "order_type": "market"
    },
    "position_action_2": {
        "direction": "short",
        "order": "open",
        "order_type": "market",
        "leverage": "5",
        "cancel": "1_long"
    }
}

pnl = 59598.08
58598.5

class block_condition(object):

Условие:
    "order"


АктивныйБлок 
 Условие: Усл

АктивныеБлоки = ПолучитьПервыйАктивныйБлок()

Цикл ТекущаяСвеча
    
    Если СостояниеСтратегии = "ПроверкаУсловийАктивныхБлоков" Тогда
        БлокСДействием = ПроверитьУсловияБлоков(ТекущаяСвеча, АктивныеБлоки);
        Если БлокСДействием <> None Тогда
            ТекущийБлок = БлокСДействием
            Состояния = "ВыполнитьДействияБлока"
        КонецЕсли 
    КонецЕcли
    Если СостояниеСтратегии = "ВыполнитьДействияБлока" Тогда
        Результат = ВыполнитьДействияБлока(ТекущийБлок)
        Если Результат Тогда
            Состояния = "ЗаполнитьАктивныеБлоки"
        КонецЕсли 
    КонецЕсли
    Если СостояниеСтратегии = "ЗаполнитьАктивныеБлоки" Тогда
        АктивныеБлоки = ЗаполнитьАктивныеБлоки(ТекущийБлок)
    КонецЕсли 

Функция ЗаполнитьАктивныеБлоки(ТекущийБлок)
    АктивныеБлоки = Парсим(ТекущийБлок.)
    Для Каждого АктивныйБлок из АктивныеБлоки

КонецФункции

Функция ПроверитьУсловияБлоков(ТекущаяСвеча, АктивныеБлоки) 
    
    Для каждого Блок из АктивныеБлоки Цикл
        БлокВыполнилВсеУсловия = ПроверитьУсловиеБлока(Блок)
        Если БлокВыполнилВсеУсловия Тогда
            Возврат Блок.НомерБлока
        КонецЕсли
    КонецЦикла     

    Возврат None

КонецФункции

Функция ПроверитьУсловиеБлока(Блок)
    
    СохраненныйНомерУсловия = None
    
    Для каждого Условие из БлокУсловие Цикл
        
        Если Условие.Исполнено Тогда
            Продолжить;
        КонецЕсли
        
        Если Условие.Номер <> СохраненныйНомерУсловия
            И СохраненныйНомерУсловия <> None
                Возврат Ложь;
        КонецЕсли
        
        Если Условие.Тип = "pnl" Тогда
            Результат = ПроверитьPnl(Условие);
            Если Не Результат Тогда
                Возврат Ложь;
            КонецЕсли;
        ИначеЕсли Условие.Тип = "Индикатор" Тогда
            Результат = ПроверитьИндикатор(Условие);
            Если Не Результат Тогда
                Возврат Ложь;
            КонецЕсли;
        КонецЕсли

        СохраненныйНомерУсловия = Условие.Номер;

        Условие.Исполнено = Истина;

    КонецЦикла
    
    Возврат Истина;

КонецФункции

    